<?xml version="1.0" encoding="UTF-8"?>
<!--
WiX Toolset v4+ Manifest Template for pyMediaManager MSI Installer
Auto-generated by wix_generator.py - DO NOT EDIT MANUALLY
-->
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs">

    <Package Name="pyMediaManager"
             Manufacturer="mosh666"
             Version="{{ version }}"
             UpgradeCode="{{ upgrade_code }}"
             Language="1033"
             Compressed="yes"
             InstallerVersion="500"
             Scope="perMachine">

        <SummaryInformation
            Keywords="Installer"
            Description="pyMediaManager - Portable media management application"
            Manufacturer="mosh666" />

        <!-- Major Upgrade Configuration: Automatically remove old versions -->
        <MajorUpgrade
            DowngradeErrorMessage="A newer version of pyMediaManager is already installed."
            AllowSameVersionUpgrades="yes"
            Schedule="afterInstallInitialize" />

        <!-- Media: Embed installer in single MSI file -->
        <Media Id="1" Cabinet="pymm.cab" EmbedCab="yes" />

        <!-- Application Icon -->
        <Icon Id="pyMM.ico" SourceFile="{{ icon_path }}" />
        <Property Id="ARPPRODUCTICON" Value="pyMM.ico" />

        <!-- Add/Remove Programs Configuration -->
        <Property Id="ARPHELPLINK" Value="https://github.com/mosh666/pyMM" />
        <Property Id="ARPURLINFOABOUT" Value="https://github.com/mosh666/pyMM" />
        <Property Id="ARPNOREPAIR" Value="yes" Secure="yes" />

        <!-- Directory Structure -->
        <StandardDirectory Id="ProgramFiles64Folder">
            <Directory Id="INSTALLFOLDER" Name="pyMediaManager">
                <!-- Python Runtime Directory -->
                <Directory Id="PYTHON_DIR" Name="{{ python_dir_name }}" />

                <!-- Python Libraries Directory -->
                <Directory Id="LIB_DIR" Name="{{ lib_dir_name }}" />

                <!-- Application Code Directory -->
                <Directory Id="APP_DIR" Name="app" />

                <!-- Plugins Directory -->
                <Directory Id="PLUGINS_DIR" Name="plugins" />

                <!-- Configuration Directory -->
                <Directory Id="CONFIG_DIR" Name="config" />
            </Directory>
        </StandardDirectory>

        <!-- Start Menu Program Shortcuts -->
        <StandardDirectory Id="ProgramMenuFolder">
            <Directory Id="ApplicationProgramsFolder" Name="pyMediaManager" />
        </StandardDirectory>

        <!-- Root Files Component (launcher.py, README.md, LICENSE) -->
        <Component Id="RootFilesComponent" Directory="INSTALLFOLDER" Guid="{{ root_files_guid }}">
            <File Id="LauncherPy" Source="{{ source_dir }}\launcher.py" KeyPath="yes" />
            <File Id="ReadmeMd" Source="{{ source_dir }}\README.md" />
            <File Id="LicenseFile" Source="{{ source_dir }}\LICENSE" />
            {% if frozen_requirements_file %}
            <File Id="FrozenRequirements" Source="{{ frozen_requirements_file }}" />
            {% endif %}
        </Component>

        <!-- Python Runtime Components -->
        <ComponentGroup Id="PythonRuntimeComponents">
            {% for component in python_components %}
            <Component Id="{{ component.id }}" Directory="PYTHON_DIR" Guid="{{ component.guid }}">
                {% for file in component.files %}
                <File Id="{{ file.id }}" Source="{{ file.source }}" ShortName="{{ file.short_name }}" {% if loop.first %}KeyPath="yes"{% endif %} />
                {% endfor %}
            </Component>
            {% endfor %}
        </ComponentGroup>

        <!-- Python Libraries Components -->
        <ComponentGroup Id="PythonLibrariesComponents">
            {% for component in lib_components %}
            <Component Id="{{ component.id }}" Directory="LIB_DIR" Guid="{{ component.guid }}">
                {% for file in component.files %}
                <File Id="{{ file.id }}" Source="{{ file.source }}" ShortName="{{ file.short_name }}" {% if loop.first %}KeyPath="yes"{% endif %} />
                {% endfor %}
            </Component>
            {% endfor %}
        </ComponentGroup>

        <!-- Application Code Components -->
        <ComponentGroup Id="ApplicationComponents">
            {% for component in app_components %}
            <Component Id="{{ component.id }}" Directory="APP_DIR" Guid="{{ component.guid }}">
                {% for file in component.files %}
                <File Id="{{ file.id }}" Source="{{ file.source }}" ShortName="{{ file.short_name }}" {% if loop.first %}KeyPath="yes"{% endif %} />
                {% endfor %}
            </Component>
            {% endfor %}
        </ComponentGroup>

        <!-- Plugins Components -->
        <ComponentGroup Id="PluginsComponents">
            {% for component in plugins_components %}
            <Component Id="{{ component.id }}" Directory="PLUGINS_DIR" Guid="{{ component.guid }}">
                {% for file in component.files %}
                <File Id="{{ file.id }}" Source="{{ file.source }}" ShortName="{{ file.short_name }}" {% if loop.first %}KeyPath="yes"{% endif %} />
                {% endfor %}
            </Component>
            {% endfor %}
        </ComponentGroup>

        <!-- Configuration Components -->
        <ComponentGroup Id="ConfigComponents">
            {% for component in config_components %}
            <Component Id="{{ component.id }}" Directory="CONFIG_DIR" Guid="{{ component.guid }}">
                {% for file in component.files %}
                <File Id="{{ file.id }}" Source="{{ file.source }}" ShortName="{{ file.short_name }}" {% if loop.first %}KeyPath="yes"{% endif %} />
                {% endfor %}
            </Component>
            {% endfor %}
        </ComponentGroup>

        <!-- Start Menu Shortcuts Component -->
        <Component Id="ApplicationShortcutComponent" Directory="ApplicationProgramsFolder" Guid="{{ shortcuts_guid }}">
            <!-- Main Application Shortcut -->
            <Shortcut Id="ApplicationStartMenuShortcut"
                      Name="pyMediaManager"
                      Description="Launch pyMediaManager"
                      Target="[PYTHON_DIR]python.exe"
                      Arguments="&quot;[INSTALLFOLDER]launcher.py&quot;"
                      WorkingDirectory="INSTALLFOLDER"
                      Icon="pyMM.ico" />

            <!-- Uninstall Shortcut -->
            <Shortcut Id="UninstallShortcut"
                      Name="Uninstall pyMediaManager"
                      Description="Uninstall pyMediaManager"
                      Target="[SystemFolder]msiexec.exe"
                      Arguments="/x [ProductCode]" />

            <!-- Required for Start Menu folder cleanup on uninstall -->
            <RemoveFolder Id="CleanupShortcutFolder" Directory="ApplicationProgramsFolder" On="uninstall" />

            <!-- Registry key to mark shortcut ownership -->
            <RegistryValue Root="HKCU"
                          Key="Software\pyMediaManager"
                          Name="installed"
                          Type="integer"
                          Value="1"
                          KeyPath="yes" />
        </Component>

        <!-- Feature: Complete Installation -->
        <Feature Id="CompleteFeature"
                 Title="pyMediaManager"
                 Description="Complete installation of pyMediaManager"
                 Level="1"
                 ConfigurableDirectory="INSTALLFOLDER"
                 AllowAdvertise="no"
                 Display="expand">

            <!-- Root Files -->
            <ComponentRef Id="RootFilesComponent" />

            <!-- Python Runtime -->
            <ComponentGroupRef Id="PythonRuntimeComponents" />

            <!-- Python Libraries -->
            <ComponentGroupRef Id="PythonLibrariesComponents" />

            <!-- Application Code -->
            <ComponentGroupRef Id="ApplicationComponents" />

            <!-- Plugins -->
            <ComponentGroupRef Id="PluginsComponents" />

            <!-- Configuration -->
            <ComponentGroupRef Id="ConfigComponents" />

            <!-- Start Menu Shortcuts -->
            <ComponentRef Id="ApplicationShortcutComponent" />
        </Feature>

    </Package>
</Wix>
